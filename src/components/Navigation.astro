---
import { getLangFromUrl, useTranslations } from "@/i18n/utils";

import { AtSign, Github, Twitter, Linkedin, Sun, Moon } from "lucide-astro";

const SOCIAL_MEDIA = [
  { name: "Github", href: "https://github.com/bjohansebas", icon: Github },
  { name: "Twitter", href: "https://x.com/bjohansebas", icon: Twitter },
  {
    name: "Linkedin",
    href: "https://www.linkedin.com/in/bjohansebas/",
    icon: Linkedin,
  },
  { name: "Contact", href: "mailto:bjohansebas@gmail.com", icon: AtSign },
];

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<div class="sticky top-0 z-50 bg-background/90 px-4 py-3 backdrop-blur-md">
  <div class="mx-auto flex max-w-[75ch] items-center justify-between">
    <a
      href={"/cv"}
      class="px-4 font-medium text-muted-foreground transition-all duration-300 hover:border-primary hover:text-primary"
    >
      Resume
    </a>
    <div class="mt-1 flex items-center gap-1">
      {
        SOCIAL_MEDIA.map(({ name, href, ...social }) => (
          <a
            title={
              name !== "Contact"
                ? t("see.network", {
                    name: "Sebastian Beltran",
                    network: name,
                  })
                : t("see.email", {
                    name: "Sebastian Beltran",
                    email: "bjohansebas@gmail.com",
                  })
            }
            href={href}
            target="_blank"
            class="px-2 font-medium text-muted-foreground transition-all duration-300 hover:border-primary hover:text-primary"
          >
            {
              <social.icon
                class="size-4 text-inherit"
                aria-label={`${name} icon`}
              />
            }
          </a>
        ))
      }
      <button
        id="theme-toggle"
        type="button"
        title="Toggle theme"
        class="ml-2 rounded-lg p-2 text-muted-foreground transition-all duration-300 hover:bg-accent hover:text-primary"
      >
        <Sun class="hidden size-4 dark:block" />
        <Moon class="block size-4 dark:hidden" />
      </button>
    </div>
  </div>
</div>

<script>
  function getThemePreference(): "dark" | "light" {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme") as "dark" | "light";
    }
    return window.matchMedia("(prefers-color-scheme: dark)").matches
      ? "dark"
      : "light";
  }

  function setTheme(theme: "dark" | "light") {
    if (theme === "dark") {
      document.documentElement.classList.add("dark");
    } else {
      document.documentElement.classList.remove("dark");
    }
    localStorage.setItem("theme", theme);
  }

  // Set initial theme
  setTheme(getThemePreference());

  // Toggle button
  document.getElementById("theme-toggle")?.addEventListener("click", () => {
    const isDark = document.documentElement.classList.contains("dark");
    setTheme(isDark ? "light" : "dark");
  });

  // Listen for system preference changes
  window
    .matchMedia("(prefers-color-scheme: dark)")
    .addEventListener("change", (e) => {
      if (!localStorage.getItem("theme")) {
        setTheme(e.matches ? "dark" : "light");
      }
    });
</script>
