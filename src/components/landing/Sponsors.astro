---
import { Heart } from "lucide-astro";
import { getLangFromUrl, useTranslations } from "@/i18n/utils";
import sponsorsData from "@/data/sponsors.json";
import { Image } from "astro:assets";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const SPONSORS = (sponsorsData && sponsorsData.sponsors) || [];
---

<section class="flex w-full flex-col">
  <header class="mb-5 flex flex-col gap-2">
    <div class="flex items-center justify-between">
      <h2
        class="flex items-center gap-x-2 text-lg font-semibold text-foreground"
      >
        <Heart class="size-5" />{t("landing.sponsors.title")}
      </h2>
    </div>
    <p class="text-muted-foreground">
      {t("landing.sponsors.subtitle")} - {
        SPONSORS.length > 0 && (
          <>
            {t("landing.sponsors.visit")}{" "}
            <a
              href="https://github.com/sponsors/bjohansebas"
              target="_blank"
              rel="noopener noreferrer"
              class="underline hover:text-foreground"
            >
              GitHub Sponsors
            </a>
          </>
        )
      }
    </p>
  </header>

  {
    SPONSORS.length > 0 ? (
      <div class="flex flex-wrap items-center gap-2">
        {SPONSORS.map(({ name, url, avatar }) => (
          <a
            href={url}
            target="_blank"
            rel="noopener noreferrer"
            class="group relative flex items-center justify-center gap-2 rounded-2xl border bg-card px-3 py-2 transition-colors hover:border-primary"
            aria-label={name}
          >
            {avatar ? (
              <Image
                src={avatar}
                alt={`${name} avatar`}
                width={32}
                height={32}
                loading="lazy"
                class="h-8 w-8 rounded-full object-cover"
              />
            ) : (
              <div class="flex h-8 w-8 items-center justify-center rounded-full bg-muted text-sm text-foreground">
                {name ? name[0] : "?"}
              </div>
            )}

            <span class="pointer-events-none absolute -top-10 left-1/2 z-50 hidden -translate-x-1/2 rounded-md bg-background/90 px-2 py-1 text-xs text-foreground shadow-md group-hover:block group-focus:block">
              {name}
            </span>
          </a>
        ))}
      </div>
    ) : (
      <div class="flex flex-col items-center justify-center gap-4 rounded-2xl border bg-card p-8 text-center">
        <p class="text-muted-foreground">{t("landing.sponsors.empty")}</p>
        <a
          href="https://github.com/sponsors/bjohansebas"
          target="_blank"
          class="inline-flex items-center gap-2 rounded-lg border border-pink-500 bg-pink-500/10 px-4 py-2 text-sm font-medium text-pink-500 transition-colors hover:bg-pink-500/20"
        >
          <Heart class="size-4" fill="currentColor" />
          {t("landing.sponsors.become")}
        </a>
      </div>
    )
  }
</section>
