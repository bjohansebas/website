---
import Navigation from "@/components/Navigation.astro";
import Footer from "@/components/Footer.astro";
import SpeedInsights from "@vercel/speed-insights/astro";
import { getLangFromUrl } from "@/i18n/utils";
import { ui } from "@/i18n/ui";
import { defaultLang, useTranslatedPath } from "@/i18n/utils";
import "@fontsource/geist-sans/400.css";
import "@fontsource/geist-sans/600.css";
import "@fontsource/geist-sans/700.css";

interface Props {
  title?: string;
  description?: string;
  class?: string;
}

let { title: titlePage, description, class: className } = Astro.props;

const titleOG =
  titlePage ??
  "Sebastian Beltran - Full-Stack Developer & Open Source Maintainer";

const title =
  titlePage == null
    ? "Sebastian Beltran - Full-Stack Developer & Open Source Maintainer (Express.js, Node.js, Webpack)"
    : `${titlePage} | Sebastian Beltran - Full-Stack Developer & Open Source Maintainer (Express.js, Node.js, Webpack)`;

description =
  description ??
  "Hi! I'm Sebastian, a Full-stack developer with experience in web application development";

const lang = getLangFromUrl(Astro.url);
const domain = Astro.url.origin;
const url = Astro.url.href;

const availableLangs = Object.keys(ui) as (keyof typeof ui)[];

const pathname = Astro.url.pathname;
const firstSegment = pathname.split("/")[1];
const pathWithoutLang =
  firstSegment && firstSegment in ui
    ? pathname.replace(`/${firstSegment}`, "") || "/"
    : pathname;

function buildHrefForLang(l: "en" | "es") {
  const translate = useTranslatedPath(l);
  const path = pathWithoutLang || "/";
  return `${domain}${translate(path)}`;
}

const alternateLinks = availableLangs.map((l) => ({
  hreflang: l === defaultLang ? "x-default" : l,
  href: buildHrefForLang(l),
}));
---

<!doctype html>
<html lang={lang}>
  <head>
    <title>{title}</title>

    <meta charset="UTF-8" />
    <meta name="description" content={description} />

    <link rel="icon" type="image/png" href="/favicon.png" />

    <meta name="viewport" content="width=device-width" />
    <meta name="robots" content="index, follow" />
    <meta name="googlebot" content="index, follow" />

    <link rel="canonical" href={url} />

    {
      alternateLinks.map((a) => (
        <>
          <link rel="alternate" hreflang={a.hreflang} href={a.href} />
          {a.hreflang === "x-default" ? (
            <link rel="alternate" hreflang={"en"} href={a.href} />
          ) : null}
        </>
      ))
    }

    <meta property="og:url" content={url} />
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={`${domain}/og/${titleOG}`} />

    <meta name="twitter:card" content="summary_large_image" />
    <meta property="twitter:domain" content={domain.split("//")[1] ?? ""} />
    <meta property="twitter:url" content={url} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={`${domain}/og/${titleOG}`} />

    <link rel="me" href="https://mastodon.social/@bjohansebas" />
    <meta name="fediverse:creator" content="@bjohansebas@mastodon.social" />

    <link
      rel="sitemap"
      type="application/xml"
      title="Sitemap"
      href="/sitemap-index.xml"
    />

    <script is:inline>
      (function () {
        const theme =
          localStorage.getItem("theme") ||
          (window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light");
        if (theme === "dark") {
          document.documentElement.classList.add("dark");
        }
      })();
    </script>
  </head><body class="flex min-h-screen flex-col">
    <Navigation />
    <div class:list={["flex-1 px-4 lg:px-10 print:p-0", className]}>
      <slot />
    </div>
    <Footer />
    <SpeedInsights />
  </body>

  <style is:global>
    :root {
      --gradient: #1a1a1a;
      --background: 0 0% 100%;
      --foreground: 0 0% 10%;
      --muted: 30 10% 95%;
      --muted-foreground: 30 5% 40%;
      --popover: 30 20% 95%;
      --popover-foreground: 0 0% 10%;
      --card: 0 0% 100%;
      --card-foreground: 0 0% 10%;
      --border: 30 15% 85%;
      --input: 30 15% 90%;
      --primary: 24 95% 53%;
      --primary-foreground: 0 0% 100%;
      --secondary: 30 30% 15%;
      --secondary-foreground: 30 10% 97%;
      --accent: 30 20% 94%;
      --accent-foreground: 0 0% 10%;
      --destructive: 0 84.2% 60.2%;
      --destructive-foreground: 0 0% 98%;
      --ring: 24 95% 53%;
      --radius: 0.75rem;
    }

    .dark {
      --background: 0 0% 4%;
      --foreground: 30 10% 95%;
      --card: 0 0% 7%;
      --card-foreground: 30 10% 95%;
      --popover: 0 0% 7%;
      --popover-foreground: 30 10% 95%;
      --primary: 24 95% 53%;
      --primary-foreground: 0 0% 100%;
      --secondary: 30 15% 12%;
      --secondary-foreground: 30 10% 95%;
      --muted: 30 15% 12%;
      --muted-foreground: 30 10% 65%;
      --accent: 30 15% 12%;
      --accent-foreground: 30 10% 95%;
      --destructive: 0 84.2% 60.2%;
      --destructive-foreground: 0 0% 98%;
      --border: 30 15% 15%;
      --input: 30 15% 15%;
      --ring: 24 95% 53%;
    }

    * {
      @apply border-border;
    }

    body {
      @apply bg-background text-foreground;
    }

    html {
      font-family: "Geist Sans", system-ui, sans-serif;
      scroll-behavior: smooth;
      overflow-x: hidden;
      overscroll-behavior: none;
    }

    p {
      @apply text-pretty;
    }

    .print {
      display: none !important;
    }

    @media print {
      .no-print {
        display: none !important;
      }

      .print {
        display: block !important;
      }

      astro-dev-toolbar {
        display: none !important;
      }

      article {
        break-inside: avoid;
      }
    }
  </style>
</html>
